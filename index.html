<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Studio Nano Banana - Dark Mode</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .custom-loader {
            width: 50px;
            height: 50px;
            border: 5px solid #facc15;
            border-bottom-color: transparent;
            border-radius: 50%;
            display: inline-block;
            animation: rotation 1s linear infinite;
        }
        @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #e5e7eb; border-radius: 10px; }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb { background: #334155; }
    </style>
</head>
<body class="bg-slate-50 dark:bg-slate-950 text-slate-900 dark:text-slate-100 font-sans min-h-screen transition-colors duration-300">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const App = () => {
            const [prompt, setPrompt] = useState('');
            const [isGenerating, setIsGenerating] = useState(false);
            const [generatedImage, setGeneratedImage] = useState(null);
            const [history, setHistory] = useState([]);
            const [error, setError] = useState(null);

            const apiKey = ""; 

            const generateImage = async (promptText) => {
                if (!promptText.trim()) return;
                setIsGenerating(true);
                setError(null);

                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            instances: { prompt: promptText },
                            parameters: { sampleCount: 1 }
                        })
                    });

                    if (!response.ok) throw new Error("Errore nella generazione. Verifica la tua API Key.");

                    const data = await response.json();
                    const base64 = `data:image/png;base64,${data.predictions[0].bytesBase64Encoded}`;
                    
                    setGeneratedImage(base64);
                    setHistory(prev => [{ prompt: promptText, url: base64, id: Date.now() }, ...prev]);
                } catch (err) {
                    setError(err.message);
                } finally {
                    setIsGenerating(false);
                }
            };

            return (
                <div className="p-4 md:p-10 lg:p-16">
                    <div className="max-w-6xl mx-auto">
                        <header className="mb-10 flex justify-between items-center">
                            <div>
                                <h1 className="text-4xl font-black mb-1">Studio Nano Banana</h1>
                                <p className="text-slate-500 dark:text-slate-400 font-medium italic">Creativit√† dinamica tra luce e ombra</p>
                            </div>
                            <div className="hidden md:block bg-yellow-400 p-3 rounded-2xl rotate-3 shadow-lg shadow-yellow-500/20">
                                <i className="fas fa-moon text-white text-2xl"></i>
                            </div>
                        </header>

                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            <div className="lg:col-span-2 space-y-8">
                                <div className="bg-white dark:bg-slate-900 p-6 md:p-8 rounded-3xl shadow-xl dark:shadow-none border border-slate-100 dark:border-slate-800 transition-colors">
                                    <h3 className="text-xl font-bold mb-4">Cosa vuoi creare?</h3>
                                    <textarea 
                                        className="w-full h-32 p-4 rounded-2xl border-2 border-slate-100 dark:border-slate-800 bg-transparent focus:border-yellow-400 dark:focus:border-yellow-500 focus:ring-0 outline-none transition-all text-lg"
                                        placeholder="Descrivi la tua idea..."
                                        value={prompt}
                                        onChange={(e) => setPrompt(e.target.value)}
                                    />
                                    <button 
                                        onClick={() => generateImage(prompt)}
                                        disabled={isGenerating || !prompt.trim()}
                                        className="w-full mt-6 bg-yellow-400 hover:bg-yellow-500 text-slate-900 font-black py-4 rounded-2xl text-xl transition-all active:scale-95 disabled:opacity-30 shadow-lg shadow-yellow-400/20"
                                    >
                                        {isGenerating ? "GENERAZIONE IN CORSO..." : "GENERA IMMAGINE"}
                                    </button>
                                </div>

                                <div className="bg-white dark:bg-slate-900 rounded-3xl shadow-xl dark:shadow-none border border-slate-100 dark:border-slate-800 overflow-hidden min-h-[450px] flex items-center justify-center relative">
                                    {isGenerating ? (
                                        <div className="text-center">
                                            <span className="custom-loader mb-4"></span>
                                            <p className="text-slate-400 font-bold">L'IA sta elaborando i pixel...</p>
                                        </div>
                                    ) : error ? (
                                        <div className="text-center p-10">
                                            <i className="fas fa-exclamation-circle text-red-500 text-4xl mb-4"></i>
                                            <p className="text-red-600 font-bold">{error}</p>
                                        </div>
                                    ) : generatedImage ? (
                                        <div className="group relative w-full h-full">
                                            <img src={generatedImage} className="w-full h-full object-contain" alt="IA Generated" />
                                            <a 
                                                href={generatedImage} 
                                                download="banana-art.png"
                                                className="absolute top-4 right-4 bg-white/80 dark:bg-slate-800/80 p-3 rounded-xl opacity-0 group-hover:opacity-100 transition-opacity backdrop-blur-md"
                                            >
                                                <i className="fas fa-download"></i>
                                            </a>
                                        </div>
                                    ) : (
                                        <div className="text-center text-slate-200 dark:text-slate-800 p-20">
                                            <i className="fas fa-wand-sparkles text-8xl mb-6"></i>
                                            <p className="text-2xl font-bold">Pronto per il prompt</p>
                                        </div>
                                    )}
                                </div>
                            </div>

                            <div className="bg-white dark:bg-slate-900 p-6 md:p-8 rounded-3xl shadow-xl dark:shadow-none border border-slate-100 dark:border-slate-800 h-full max-h-[750px] flex flex-col">
                                <h3 className="text-xl font-bold mb-6 flex items-center gap-2">
                                    <i className="fas fa-clock-rotate-left text-slate-400"></i> Cronologia
                                </h3>
                                <div className="space-y-4 overflow-y-auto pr-2 custom-scrollbar">
                                    {history.length === 0 ? (
                                        <p className="text-slate-400 dark:text-slate-600 italic text-center py-10">Cronologia vuota</p>
                                    ) : (
                                        history.map(item => (
                                            <div key={item.id} className="group relative rounded-2xl overflow-hidden border border-slate-100 dark:border-slate-800 hover:border-yellow-400 transition-all cursor-pointer" onClick={() => setGeneratedImage(item.url)}>
                                                <img src={item.url} className="w-full h-28 object-cover" />
                                                <div className="p-3 bg-slate-50 dark:bg-slate-800/50">
                                                    <p className="text-[10px] text-slate-500 dark:text-slate-400 truncate font-mono uppercase tracking-tighter">{item.prompt}</p>
                                                </div>
                                            </div>
                                        ))
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

